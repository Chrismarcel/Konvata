<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
        crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Lato:100,300,400,500" rel="stylesheet">
    <link rel="stylesheet" href="./css/style.css">
    <title>Currency Converter</title>
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-sm-offset-4 col-sm-4 main">
                <div class="converter">
                    <div class="converter-display">
                        <span class="converter-display__header text-center">
                            Currency Converter
                        </span>
                        <div class="converter__container">
                            <div class="col-xs-12 conversion">
                                <select name="currencies" class="form-control convert__currency-list" id="convert--to">
                                    <option value="NGN">NGN</option>
                                    <option value="EUR">EUR</option>
                                    <option value="USD">USD</option>
                                    <option value="PHP">PHP</option>
                                </select>
                                <div class="convert conversion__container--display">
                                    <span class="converter__currency-display converted">0</span>
                                </div>
                            </div>
                            <div class="col-xs-12 toggle-currency text-center">
                                <button class="btn btn-primary toggle-currency__switch">
                                    <span>&#8593;&#8595;</span>
                                </button>
                            </div>
                            <div class="col-xs-12 conversion">
                                <select name="currencies" class="form-control convert__currency-list" id="convert--from">
                                    <option value="NGN">NGN</option>
                                    <option value="EUR">EUR</option>
                                    <option value="USD">USD</option>
                                    <option value="PHP">PHP</option>
                                </select>
                                <div class="convert conversion__container--display">
                                    <span class="converter__currency-display amount">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="calculator__to-currency">
                        <div class="converter__container">
                            <div class="col-xs-12 converter__input">
                                <div class="col-xs-4 converter__currency-input">
                                    <button class="btn btn-primary btn-value" value="1">
                                        1
                                    </button>
                                </div>
                                <div class="col-xs-4 currency-input">
                                    <button class="btn btn-primary btn-value" value="2">
                                        2
                                    </button>
                                </div>
                                <div class="col-xs-4 currency-input">
                                    <button class="btn btn-primary btn-value" value="3">
                                        3
                                    </button>
                                </div>
                                <div class="col-xs-4 currency-input">
                                    <button class="btn btn-primary btn-value" value="4">
                                        4
                                    </button>
                                </div>
                                <div class="col-xs-4 currency-input">
                                    <button class="btn btn-primary btn-value" value="5">
                                        5
                                    </button>
                                </div>
                                <div class="col-xs-4 currency-input">
                                    <button class="btn btn-primary btn-value" value="6">
                                        6
                                    </button>
                                </div>
                                <div class="col-xs-4 currency-input">
                                    <button class="btn btn-primary btn-value" value="7">
                                        7
                                    </button>
                                </div>
                                <div class="col-xs-4 currency-input">
                                    <button class="btn btn-primary btn-value" value="8">
                                        8
                                    </button>
                                </div>
                                <div class="col-xs-4 currency-input">
                                    <button class="btn btn-primary btn-value" value="9">
                                        9
                                    </button>
                                </div>
                                <div class="col-xs-4 currency-input">
                                    <button class="btn btn-primary btn-value" value=".">
                                        .
                                    </button>
                                </div>
                                <div class="col-xs-4 currency-input">
                                    <button class="btn btn-primary btn-value" value="0">
                                        0
                                    </button>
                                </div>
                                <div class="col-xs-4 currency-input">
                                    <button class="btn btn-primary btn-value" value="del">
                                        &#9003;
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script src="./js/idb.js"></script>
<script src="./js/controller.js"></script>
<script src="./sw.js"></script>

<script>
    // Populate the select options via the listCurrencies static method
    const selectOptions = Array.from(document.querySelectorAll('.convert__currency-list'));
    //CurrencyConverter.listCurrencies(selectOptions);

    const currencyLists = Array.from(document.querySelectorAll('.convert__currency-list'));
    currencyLists.map(currencyList => {
        currencyList.addEventListener('change', function () {
            convertCurrency();
        });
    });

    const inputValues = Array.from(document.querySelectorAll('.btn-value'));
    inputValues.map(inputValue => {
        inputValue.addEventListener('click', function() {
            const inputValue = this.value;
            const amountDisplay = document.querySelector('.amount');
            
            if(inputValue === 'del') {
                amountDisplay.textContent = amountDisplay.textContent.slice(0, -1);
                if(amountDisplay.textContent === '') {
                    amountDisplay.textContent = 0;
                    document.querySelector('.converted').textContent = 0;
                }
                if (!amountDisplay.textContent.includes('.')) {
                    document.querySelector('.btn-value[value="."]').removeAttribute('disabled');
                }
            } else {
                amountDisplay.textContent += inputValue;
                if (amountDisplay.textContent.includes('.')) {
                    document.querySelector('.btn-value[value="."]').setAttribute('disabled', 'disabled');
                }
                if (this.value !== '.') {
                    amountDisplay.textContent = parseFloat(amountDisplay.textContent);
                }
            }
            convertCurrency();
        });
    });

    const toggleBtn = document.querySelector('.toggle-currency__switch');
    toggleBtn.addEventListener('click', function (event) {
        let currencyFrom = document.querySelector('#convert--from').value;
        let currencyTo = document.querySelector('#convert--to').value;
        let valueFrom = document.querySelector('.amount').textContent;
        let valueTo = document.querySelector('.converted').getAttribute('data-num-value');

        // Use destructuring to swap values
        [currencyFrom, valueFrom, currencyTo, valueTo] = [currencyTo, valueTo, currencyFrom, valueFrom];

        document.querySelector('#convert--from').value = currencyFrom;
        document.querySelector('#convert--to').value = currencyTo;
        document.querySelector('.amount').textContent = valueFrom;
        document.querySelector('.converted').textContent = valueTo.toLocaleString('en', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });
    });

    convertCurrency = () => {
        const currencyTo = document.querySelector('#convert--to').value;
        const currencyFrom = document.querySelector('#convert--from').value;
        const value = document.querySelector('.amount').textContent;
        const currencies = `${currencyFrom}_${currencyTo}`;

        // Creates a new instance of CurrencyConverter
        const convertCurrency = new CurrencyConverter(currencies, value);
    }
</script>